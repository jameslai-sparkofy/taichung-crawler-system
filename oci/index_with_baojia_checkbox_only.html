<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÂÖÉÂøÉÂª∫ÊùêÂª∫Ê°àÊï¥ÁêÜ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Microsoft JhengHei', sans-serif;
            background-color: #f8f9fa;
            line-height: 1.6;
            color: #333;
        }
        
        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 15px;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        .header h1 {
            font-size: 1.8em;
            margin-bottom: 5px;
        }
        
        .header p {
            opacity: 0.9;
            font-size: 0.95em;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            text-align: center;
        }
        
        .stat-card h3 {
            color: #666;
            font-size: 0.85em;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .stat-card .value {
            font-size: 2em;
            font-weight: bold;
            color: #667eea;
        }
        
        .stat-card .subtitle {
            color: #888;
            font-size: 0.8em;
            margin-top: 5px;
        }
        
        .collapsible-section {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            margin-bottom: 15px;
            overflow: hidden;
        }
        
        .section-header {
            background: #f8f9fa;
            padding: 15px 20px;
            cursor: pointer;
            user-select: none;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #e9ecef;
        }
        
        .section-header:hover {
            background: #e9ecef;
        }
        
        .section-header h2 {
            font-size: 1.2em;
            color: #333;
        }
        
        .section-header .toggle-icon {
            font-size: 1.2em;
            transition: transform 0.3s ease;
        }
        
        .section-header.collapsed .toggle-icon {
            transform: rotate(-90deg);
        }
        
        .section-content {
            padding: 20px;
            display: none;
        }
        
        .section-content.expanded {
            display: block;
        }
        
        .filter-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .filter-group {
            display: flex;
            flex-direction: column;
        }
        
        .filter-group label {
            font-weight: 600;
            margin-bottom: 5px;
            color: #555;
            font-size: 0.9em;
        }
        
        .filter-group select,
        .filter-group input {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 0.9em;
        }
        
        .filter-buttons {
            display: flex;
            gap: 10px;
        }
        
        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9em;
            transition: background-color 0.3s ease;
        }
        
        .btn-primary {
            background-color: #667eea;
            color: white;
        }
        
        .btn-primary:hover {
            background-color: #5a6fd8;
        }
        
        .btn-secondary {
            background-color: #6c757d;
            color: white;
        }
        
        .btn-secondary:hover {
            background-color: #5a6268;
        }
        
        .log-entry {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 6px;
            border-left: 4px solid #667eea;
        }
        
        .log-entry .date {
            font-weight: bold;
            color: #667eea;
            margin-bottom: 8px;
        }
        
        .log-entry .details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            font-size: 0.9em;
        }
        
        .log-entry .detail-item {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }
        
        .log-entry .detail-label {
            color: #666;
            font-size: 0.8em;
        }
        
        .log-entry .detail-value {
            font-weight: 600;
            color: #333;
        }
        
        .main-section {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .main-header {
            background: #f8f9fa;
            padding: 15px 20px;
            border-bottom: 1px solid #e9ecef;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .main-header h2 {
            font-size: 1.3em;
            color: #333;
        }
        
        .search-controls {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .search-input {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            width: 200px;
            font-size: 0.9em;
        }
        
        .ai-search-container {
            display: flex;
            gap: 10px;
            align-items: center;
            margin-left: 20px;
            position: relative;
        }
        
        .ai-search-input {
            padding: 10px 15px;
            border: 2px solid #667eea;
            border-radius: 25px;
            width: 300px;
            font-size: 0.9em;
            outline: none;
            transition: all 0.3s;
        }
        
        .ai-search-input:focus {
            width: 350px;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .ai-search-btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 0.9em;
            display: flex;
            align-items: center;
            gap: 5px;
            transition: all 0.3s;
            white-space: nowrap;
        }
        
        .ai-search-btn:hover {
            background: #5a67d8;
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }
        
        .ai-search-btn:disabled {
            background: #9ca3af;
            cursor: not-allowed;
        }
        
        .ai-search-results {
            position: absolute;
            top: 100%;
            left: 0;
            width: 100%;
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            margin-top: 5px;
            padding: 10px;
            display: none;
            max-height: 200px;
            overflow-y: auto;
        }
        
        .ai-search-loading {
            text-align: center;
            color: #666;
            padding: 20px;
        }
        
        .filter-results {
            padding: 10px 20px;
            background: #f8f9fa;
            border-bottom: 1px solid #e9ecef;
            color: #666;
            font-size: 0.9em;
        }
        
        .permits-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .table-header {
            background: #667eea;
            color: white;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        
        .table-header th {
            padding: 12px 8px;
            text-align: left;
            font-weight: 600;
            font-size: 0.9em;
            cursor: pointer;
            user-select: none;
            border-right: 1px solid rgba(255,255,255,0.2);
        }
        
        .table-header th:hover {
            background: rgba(255,255,255,0.1);
        }
        
        .table-header th.sortable::after {
            content: " ‚Üï";
            opacity: 0.5;
        }
        
        .table-header th.sort-asc::after {
            content: " ‚Üë";
            opacity: 1;
        }
        
        .table-header th.sort-desc::after {
            content: " ‚Üì";
            opacity: 1;
        }
        
        .table-header th.clickable {
            position: relative;
        }
        
        .table-header th.clickable::before {
            content: "üîç";
            position: absolute;
            right: 5px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 0.7em;
            opacity: 0.7;
        }
        
        .table-row {
            border-bottom: 1px solid #e9ecef;
            transition: background-color 0.2s ease;
        }
        
        .table-row:hover {
            background: #f8f9fa;
        }
        
        .table-row:nth-child(even) {
            background: rgba(102, 126, 234, 0.02);
        }
        
        .table-row:nth-child(even):hover {
            background: #f8f9fa;
        }
        
        .table-row td {
            padding: 10px 8px;
            font-size: 0.85em;
            border-right: 1px solid #f0f0f0;
        }
        
        .permit-number {
            color: #667eea;
            font-weight: 600;
        }
        
        .applicant-cell {
            cursor: pointer;
            color: #495057;
        }
        
        .applicant-cell:hover {
            color: #667eea;
            text-decoration: underline;
        }
        
        .district-cell {
            cursor: pointer;
            color: #495057;
        }
        
        .district-cell:hover {
            color: #667eea;
            text-decoration: underline;
        }
        
        .number-cell {
            text-align: center;
            font-weight: 500;
        }
        
        .area-cell {
            text-align: right;
            font-weight: 500;
        }
        
        .date-cell {
            color: #666;
            font-size: 0.8em;
        }
        
        .btn-detail {
            background: #667eea;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8em;
            transition: background-color 0.3s ease;
        }
        
        .btn-detail:hover {
            background: #5a6fd8;
        }
        
        .btn-link {
            background: #28a745;
            color: white;
            text-decoration: none;
            padding: 6px 12px;
            border-radius: 4px;
            font-size: 0.8em;
            transition: background-color 0.3s ease;
            display: inline-block;
        }
        
        .btn-link:hover {
            background: #218838;
            color: white;
            text-decoration: none;
        }
        
        .dropdown-menu {
            position: absolute;
            background: white;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            max-height: 200px;
            overflow-y: auto;
            z-index: 1000;
            min-width: 150px;
        }
        
        .dropdown-item {
            padding: 8px 12px;
            cursor: pointer;
            font-size: 0.9em;
            border-bottom: 1px solid #f0f0f0;
        }
        
        .dropdown-item:hover {
            background: #f8f9fa;
        }
        
        .dropdown-item:last-child {
            border-bottom: none;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }
        
        .error {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 6px;
            border: 1px solid #f5c6cb;
            margin: 20px;
        }
        
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }
        
        .modal-content {
            background-color: white;
            margin: 3% auto;
            padding: 0;
            border-radius: 8px;
            max-width: 900px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 10px 50px rgba(0,0,0,0.3);
        }
        
        .modal-header {
            background: #667eea;
            color: white;
            padding: 20px;
            border-radius: 8px 8px 0 0;
            position: relative;
        }
        
        .modal-header h3 {
            margin: 0;
            font-size: 1.4em;
        }
        
        .close {
            color: white;
            position: absolute;
            right: 20px;
            top: 20px;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            opacity: 0.8;
        }
        
        .close:hover {
            opacity: 1;
        }
        
        .permit-detail {
            padding: 20px;
        }
        
        .detail-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }
        
        .detail-table th,
        .detail-table td {
            border: 1px solid #ddd;
            padding: 10px;
            text-align: left;
            font-size: 0.9em;
        }
        
        .detail-table th {
            background: #f8f9fa;
            font-weight: 600;
            width: 150px;
            color: #495057;
        }
        
        .detail-table td {
            background: white;
        }
        
        .detail-section-title {
            background: #667eea;
            color: white;
            font-weight: bold;
            text-align: center;
            padding: 12px;
            margin: 0;
        }
        
        /* Ê°åÊ©ü/ÊâãÊ©üÈ°ØÁ§∫ÊéßÂà∂ */
        .mobile-only {
            display: none;
        }
        
        .desktop-only {
            display: block;
        }
        
        /* ÊêúÂ∞ãÂçÄÂüü */
        .search-section {
            padding: 20px;
            background: white;
        }
        
        /* Ê°åÊ©üÁâàÊêúÂ∞ãÊéßÂà∂ */
        .desktop-search-controls {
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .desktop-search-controls .search-input {
            flex: 0 1 250px;
            max-width: 250px;
        }
        
        .desktop-search-controls .ai-search-container {
            display: flex;
            gap: 10px;
            flex: 0 1 auto;
            max-width: 500px;
            position: relative;
        }
        
        /* ÊªëÂá∫ÂºèÊêúÂ∞ãÈù¢Êùø */
        .search-toggle {
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
        }
        
        .search-panel {
            position: fixed;
            top: 0;
            right: -400px;
            width: 400px;
            height: 100vh;
            background: white;
            box-shadow: -2px 0 10px rgba(0,0,0,0.1);
            transition: right 0.3s ease;
            z-index: 1001;
            overflow-y: auto;
        }
        
        .search-panel.active {
            right: 0;
        }
        
        .search-panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            background: #f8f9fa;
            border-bottom: 1px solid #dee2e6;
        }
        
        .close-btn {
            background: none;
            border: none;
            font-size: 1.5em;
            cursor: pointer;
            color: #666;
        }
        
        .search-controls {
            padding: 20px;
        }
        
        .search-group {
            margin-bottom: 20px;
        }
        
        .search-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #495057;
        }
        
        .search-group .ai-search-input {
            width: 100%;
            margin-bottom: 10px;
        }
        
        .search-group .ai-search-btn {
            width: 100%;
        }
        
        .search-actions {
            margin-top: 20px;
            text-align: center;
        }
        
        /* ÂàÜÈ†ÅÊ®£Âºè */
        .pagination-controls {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        
        .pagination-info {
            color: #666;
            font-size: 0.9em;
        }
        
        .page-buttons {
            display: flex;
            gap: 5px;
        }
        
        .page-btn {
            padding: 5px 10px;
            border: 1px solid #dee2e6;
            background: white;
            color: #333;
            cursor: pointer;
            border-radius: 4px;
            transition: all 0.2s;
        }
        
        .page-btn:hover {
            background: #f8f9fa;
        }
        
        .page-btn.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }
        
        .page-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .page-size-selector {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .page-size-selector select {
            padding: 5px;
            border: 1px solid #dee2e6;
            border-radius: 4px;
        }
        
        /* Mobile ÂÑ™Âåñ */
        @media (max-width: 768px) {
            /* È°ØÁ§∫ÊéßÂà∂ */
            .mobile-only {
                display: block;
            }
            
            .desktop-only {
                display: none;
            }
            
            .desktop-search-controls {
                display: none;
            }
            
            .container {
                padding: 0;
                max-width: 100%;
            }
            
            .header {
                padding: 15px;
                text-align: center;
            }
            
            .header h1 {
                font-size: 1.5em;
            }
            
            .header p {
                font-size: 0.85em;
            }
            
            /* Áµ±Ë®àÂç°ÁâáÊîπÁÇ∫ 2x2 Á∂≤Ê†º */
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 10px;
                padding: 0 10px;
            }
            
            .stat-card {
                padding: 12px;
            }
            
            .stat-card h3 {
                font-size: 0.85em;
            }
            
            .stat-card .value {
                font-size: 1.8em;
            }
            
            .stat-card .subtitle {
                font-size: 0.75em;
            }
            
            /* ÊêúÂ∞ãÂçÄÂüüÂÑ™Âåñ */
            .search-section {
                padding: 15px;
            }
            
            .ai-search-container {
                flex-direction: column;
                gap: 10px;
            }
            
            .search-input {
                width: 100%;
                font-size: 16px; /* Èò≤Ê≠¢ iOS Ëá™ÂãïÁ∏ÆÊîæ */
                padding: 12px;
            }
            
            .search-button {
                width: 100%;
                padding: 12px;
                font-size: 1em;
            }
            
            /* ÁØ©ÈÅ∏ÊéßÂà∂È†Ö */
            .filter-controls {
                flex-direction: column;
                gap: 10px;
                padding: 10px;
            }
            
            .filter-controls select,
            .filter-controls input {
                width: 100%;
                font-size: 16px;
                padding: 10px;
            }
            
            /* Ë°®Ê†ºÂÆπÂô®ÂèØÊ©´ÂêëÊªæÂãï */
            .table-container {
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
                margin: 15px 0;
                padding: 0;
            }
            
            .permits-table {
                min-width: 800px;
                font-size: 0.85em;
            }
            
            .permits-table th,
            .permits-table td {
                padding: 8px 5px;
                font-size: 0.85em;
            }
            
            /* ÈáçË¶ÅÊ¨Ñ‰Ωç‰∏çÈö±ËóèÔºåÊîπÁî®Ê©´ÂêëÊªæÂãï */
            .permits-table th,
            .permits-table td {
                display: table-cell !important;
            }
            
            /* ÂèØÊë∫ÁñäÂçÄÂ°ä */
            .collapsible-section {
                margin: 0 5px 15px 5px;
            }
            
            .section-header {
                padding: 12px;
                font-size: 0.9em;
            }
            
            .section-header h2 {
                font-size: 1.1em;
            }
            
            /* Âü∑Ë°åË®òÈåÑË™øÊï¥ */
            .log-entry {
                font-size: 0.85em;
                padding: 10px;
            }
            
            .details {
                grid-template-columns: 1fr;
                gap: 8px;
            }
            
            /* Áõ£ÊéßÈù¢ÊùøÊåâÈàï */
            .monitor-button {
                width: 100%;
                margin-top: 15px;
            }
            
            /* Ë°®Ê†ºÊªæÂãïÊèêÁ§∫ */
            .table-container::after {
                content: "‚Üê Â∑¶Âè≥ÊªëÂãïÊü•ÁúãÊõ¥Â§ö ‚Üí";
                display: block;
                text-align: center;
                color: #999;
                font-size: 0.8em;
                margin-top: 10px;
                padding: 5px;
            }
            
            /* ÊêúÂ∞ãÈù¢ÊùøÊâãÊ©üÁâà */
            .search-panel {
                width: 100%;
                right: -100%;
            }
            
            .search-toggle {
                position: static;
                transform: none;
                width: auto;
                padding: 8px 15px;
                font-size: 0.9em;
            }
            
            .main-header {
                display: flex;
                justify-content: space-between;
                align-items: center;
                flex-wrap: nowrap;
                padding: 15px 10px !important;
            }
            
            .main-header h2 {
                font-size: 1.3em;
                margin: 0;
            }
            
            /* ÂàÜÈ†ÅÊéßÂà∂ÊâãÊ©üÁâà */
            .pagination-controls {
                font-size: 0.85em;
                margin: 15px 0;
                padding: 10px 0;
            }
            
            .page-size-selector {
                margin-bottom: 10px;
            }
            
            /* ‰∏ªË¶ÅÂçÄÂ°ä */
            .main-section {
                padding: 0;
            }
            
            /* ÊåâÈàïÂú®ÊâãÊ©üÁâàÁöÑË™øÊï¥ */
            .btn-detail, .btn-link {
                padding: 4px 8px;
                font-size: 0.8em;
                white-space: nowrap;
            }
            
            /* filter-results ÊâãÊ©üÁâàË™øÊï¥ */
            .filter-results {
                padding: 10px !important;
            }
            
            /* ‰øÆÊ≠£ loading ÁãÄÊÖãÁöÑ padding */
            .loading {
                padding: 20px 0 !important;
            }
            
            /* permitsList ÂÆπÂô®‰∏çË¶ÅÊúâÈ°çÂ§ñ padding */
            #permitsList {
                padding: 0 !important;
            }
            
            /* ÊâãÊ©üÁâàÊêúÂ∞ãÊéßÂà∂È†ÖË™øÊï¥ */
            .search-panel .ai-search-container {
                flex-direction: column;
                gap: 10px;
            }
            
            .search-panel .ai-search-input {
                width: 100%;
            }
            
            .search-panel .ai-search-btn {
                width: 100%;
                justify-content: center;
            }
            
            /* Âú®ÊâãÊ©üÁâàÈö±ËóèÊ°åÈù¢ÁâàÁöÑAIÊêúÂ∞ãÁµêÊûú */
            #aiSearchResultsDesktop {
                display: none !important;
            }
        }
        
        /* Â∞èÊâãÊ©üÂÑ™Âåñ */
        @media (max-width: 375px) {
            .header h1 {
                font-size: 1.3em;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .permits-table {
                font-size: 0.8em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üèóÔ∏è ÂÖÉÂøÉÂª∫ÊùêÂª∫Ê°àÊï¥ÁêÜ</h1>
            <p>Âç≥ÊôÇÁõ£ÊéßÂè∞‰∏≠Â∏ÇÂª∫ÁØâÂü∑ÁÖßÁà¨ÂèñÁãÄÊÖã</p>
        </div>
        
        <div class="stats-grid" id="statsGrid">
            <div class="stat-card">
                <h3>Á∏ΩÂª∫ÁÖßÊï∏</h3>
                <div class="value" id="totalPermits">-</div>
                <div class="subtitle">Á¥ØË®àÁà¨Âèñ</div>
            </div>
            <div class="stat-card">
                <h3>ÊúÄÊñ∞Âª∫Ê°à</h3>
                <div class="value" id="latestPermit" style="font-size: 1.2em;">-</div>
                <div class="subtitle" id="latestPermitApplicant">-</div>
                <div class="subtitle" id="crawlStatus" style="margin-top: 5px; color: #28a745;">‚úÖ Ê≠£Â∏∏</div>
            </div>
        </div>
        
        <div class="collapsible-section">
            <div class="section-header mobile-collapsed" onclick="toggleSection(this)">
                <h2>üìä ÊúÄÊñ∞Âü∑Ë°åË®òÈåÑ</h2>
                <span class="toggle-icon">‚ñº</span>
            </div>
            <div class="section-content" style="display: none;">
                <div id="latestLog" class="loading">ËºâÂÖ•‰∏≠...</div>
                <div style="margin-top: 20px; text-align: center;">
                    <a href="https://objectstorage.ap-tokyo-1.oraclecloud.com/n/nrsdi1rz5vl8/b/taichung-building-permits/o/monitor.html" 
                       target="_blank" 
                       class="monitor-button"
                       style="display: inline-block; padding: 10px 20px; background-color: #007bff; color: white; text-decoration: none; border-radius: 5px; font-weight: bold; transition: background-color 0.3s;">
                        üñ•Ô∏è Áõ£ÊéßÈù¢Êùø
                    </a>
                </div>
            </div>
        </div>
        
        <div class="collapsible-section">
            <div class="section-header mobile-collapsed" onclick="toggleSection(this)">
                <h2>üîç Ë≥áÊñôÁØ©ÈÅ∏</h2>
                <span class="toggle-icon">‚ñº</span>
            </div>
            <div class="section-content" style="display: none;">
                <div class="filter-grid">
                    <div class="filter-group">
                        <label for="yearFilter">Âπ¥‰ªΩ</label>
                        <select id="yearFilter">
                            <option value="">ÂÖ®ÈÉ®Âπ¥‰ªΩ</option>
                            <option value="114">114Âπ¥</option>
                            <option value="113">113Âπ¥</option>
                            <option value="112">112Âπ¥</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label for="startDate">ÈñãÂßãÊó•Êúü</label>
                        <input type="date" id="startDate">
                    </div>
                    <div class="filter-group">
                        <label for="endDate">ÁµêÊùüÊó•Êúü</label>
                        <input type="date" id="endDate">
                    </div>
                    <div class="filter-group">
                        <label for="districtFilter">Ë°åÊîøÂçÄ</label>
                        <select id="districtFilter">
                            <option value="">ÂÖ®ÈÉ®ÂçÄÂüü</option>
                        </select>
                    </div>
                </div>
                <div class="filter-buttons">
                    <button class="btn btn-primary" onclick="applyFilters()">Â•óÁî®ÁØ©ÈÅ∏</button>
                    <button class="btn btn-secondary" onclick="clearFilters()">Ê∏ÖÈô§ÁØ©ÈÅ∏</button>
                </div>
            </div>
        </div>
        
        <div class="main-section">
            <div class="main-header">
                <h2>üìë Âª∫ÁÖßË≥áÊñôÂàóË°®</h2>
                <button class="btn btn-primary search-toggle mobile-only" onclick="toggleSearchPanel()">
                    üîç ÊêúÂ∞ã
                </button>
            </div>
            
            <!-- Ê°åÊ©üÁâàÊêúÂ∞ãÂçÄÂüü -->
            <div class="search-section">
                <div class="desktop-search-controls">
                    <input type="text" class="search-input" id="applicantSearchDesktop" placeholder="ÊêúÂ∞ãËµ∑ÈÄ†‰∫∫..." onkeyup="searchApplicant(this.value, 'desktop')">
                    <button class="btn btn-secondary" onclick="clearSearch()">Ê∏ÖÈô§</button>
                    
                    <div class="ai-search-container">
                        <input type="text" 
                               class="ai-search-input" 
                               id="aiSearchInputDesktop" 
                               placeholder="Ëá™ÁÑ∂Ë™ûË®ÄÊêúÂ∞ã (‰æã: 113Âπ¥3ÊúàÂæåÂåóÂ±ØÂçÄ7Ê®ì‰ª•‰∏ä)" 
                               onkeypress="if(event.key==='Enter') performAISearch('desktop')">
                        <button class="ai-search-btn" id="aiSearchBtnDesktop" onclick="performAISearch('desktop')">
                            <span>ü§ñ</span>
                            <span>Êô∫ÊÖßÊêúÂ∞ã</span>
                        </button>
                        <div class="ai-search-results" id="aiSearchResultsDesktop"></div>
                    </div>
                    
                    <!-- ÂØ∂‰Ω≥ÁØ©ÈÅ∏ -->
                    <div style="display: flex; align-items: center; margin-left: 15px;">
                        <label style="display: flex; align-items: center; cursor: pointer; font-size: 1.1em;">
                            <input type="checkbox" id="baojiaFilter" onchange="toggleBaojiaFilter()" style="margin-right: 8px; transform: scale(1.2);">
                            <span>üèóÔ∏è ÂØ∂‰Ω≥Ê©üÊßã</span>
                        </label>
                    </div>
                </div>
            </div>
            
            <!-- ÊâãÊ©üÁâàÊªëÂá∫ÂºèÊêúÂ∞ãÈù¢Êùø -->
            <div class="search-panel mobile-only" id="searchPanel">
                <div class="search-panel-header">
                    <h3>ÊêúÂ∞ãÈÅ∏È†Ö</h3>
                    <button class="close-btn" onclick="toggleSearchPanel()">‚úï</button>
                </div>
                <div class="search-controls">
                    <div class="search-group">
                        <label>Ëµ∑ÈÄ†‰∫∫ÊêúÂ∞ã</label>
                        <input type="text" class="search-input" id="applicantSearchMobile" placeholder="ÊêúÂ∞ãËµ∑ÈÄ†‰∫∫..." onkeyup="searchApplicant(this.value, 'mobile')">
                    </div>
                    
                    <div class="search-group">
                        <label>Êô∫ÊÖßÊêúÂ∞ã</label>
                        <input type="text" 
                               class="ai-search-input" 
                               id="aiSearchInputMobile" 
                               placeholder="Ëá™ÁÑ∂Ë™ûË®ÄÊêúÂ∞ã (‰æã: 113Âπ¥3ÊúàÂæåÂåóÂ±ØÂçÄ7Ê®ì‰ª•‰∏ä)" 
                               onkeypress="if(event.key==='Enter') performAISearch('mobile')">
                        <button class="ai-search-btn" id="aiSearchBtnMobile" onclick="performAISearch('mobile')">
                            <span>ü§ñ</span>
                            <span>Êô∫ÊÖßÊêúÂ∞ã</span>
                        </button>
                        <div class="ai-search-results" id="aiSearchResultsMobile"></div>
                    </div>
                    
                    <div class="search-actions">
                        <button class="btn btn-secondary" onclick="clearAllSearches()">Ê∏ÖÈô§ÂÖ®ÈÉ®</button>
                    </div>
                </div>
            </div>
            
            <div class="filter-results" id="filterResults"></div>
            
            <!-- ÂàÜÈ†ÅÊéßÂà∂ -->
            <div class="pagination-controls" id="paginationTop"></div>
            
            <div id="permitsList" class="loading">ËºâÂÖ•‰∏≠...</div>
            
            <!-- Â∫ïÈÉ®ÂàÜÈ†ÅÊéßÂà∂ -->
            <div class="pagination-controls" id="paginationBottom"></div>
        </div>
    </div>
    
    <!-- Ë©≥Á¥∞Ë≥áÊñô Modal -->
    <div id="permitModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <span class="close" onclick="closeModal()">&times;</span>
                <h3 id="modalTitle">Âª∫ÁÖßË©≥Á¥∞Ë≥áÊñô</h3>
            </div>
            <div id="permitDetail" class="permit-detail"></div>
        </div>
    </div>
    
    <script>
        // API URLs
        const PERMITS_API = 'https://objectstorage.ap-tokyo-1.oraclecloud.com/n/nrsdi1rz5vl8/b/taichung-building-permits/o/all_permits.json';
        const LOGS_API = 'https://objectstorage.ap-tokyo-1.oraclecloud.com/n/nrsdi1rz5vl8/b/taichung-building-permits/o/data/crawl-logs.json';
        
        let allPermits = [];
        let filteredPermits = [];
        let sortConfig = { key: 'permitNumber', direction: 'desc' };
        let currentPage = 1;
        let pageSize = 50;
        let searchPanelOpen = false;
        let districtDropdown = null;
        let baojiaCompanies = [];
        let baojiFilterActive = false;
        
        // ÂàùÂßãÂåñ
        async function init() {
            initCollapsibleSections();
            await loadBaojiaCompanies();
            await loadData();
            await loadLogs();
            populateDistrictFilter();
        }
        
        // ÂàáÊèõÊë∫ÁñäÂçÄÊÆµ
        function toggleSection(header) {
            const content = header.nextElementSibling;
            const isCollapsed = header.classList.contains('collapsed') || header.classList.contains('mobile-collapsed');
            const icon = header.querySelector('.toggle-icon');
            
            if (isCollapsed) {
                header.classList.remove('collapsed');
                header.classList.remove('mobile-collapsed');
                content.style.display = 'block';
                icon.textContent = '‚ñ≤';
            } else {
                header.classList.add('collapsed');
                content.style.display = 'none';
                icon.textContent = '‚ñº';
            }
        }
        
        // Ê™¢Ê∏¨ÊòØÂê¶ÁÇ∫ÊâãÊ©ü
        function isMobile() {
            return window.innerWidth <= 768;
        }
        
        // ÂàùÂßãÂåñÊî∂ÂêàÁãÄÊÖã
        function initCollapsibleSections() {
            if (isMobile()) {
                // ÊâãÊ©üÈ†êË®≠Êî∂Âêà
                document.querySelectorAll('.mobile-collapsed').forEach(header => {
                    const content = header.nextElementSibling;
                    const icon = header.querySelector('.toggle-icon');
                    header.classList.add('collapsed');
                    content.style.display = 'none';
                    icon.textContent = '‚ñº';
                });
            } else {
                // Ê°åÈù¢ÁâàÈ†êË®≠Â±ïÈñã
                document.querySelectorAll('.mobile-collapsed').forEach(header => {
                    const content = header.nextElementSibling;
                    const icon = header.querySelector('.toggle-icon');
                    header.classList.remove('collapsed');
                    header.classList.remove('mobile-collapsed');
                    content.style.display = 'block';
                    icon.textContent = '‚ñ≤';
                });
            }
        }
        
        // ËºâÂÖ•Âª∫ÁÖßË≥áÊñô
        async function loadData() {
            try {
                const response = await fetch(PERMITS_API);
                const data = await response.json();
                
                allPermits = data.permits || [];
                filteredPermits = [...allPermits];
                
                updateStats(data);
                sortPermits();
                renderPermits();
                
            } catch (error) {
                console.error('ËºâÂÖ•Ë≥áÊñôÂ§±Êïó:', error);
                document.getElementById('permitsList').innerHTML = '<div class="error">ËºâÂÖ•Ë≥áÊñôÂ§±ÊïóÔºåË´ãÁ®çÂæåÂÜçË©¶</div>';
            }
        }
        
        // ËºâÂÖ•Âü∑Ë°åË®òÈåÑ
        async function loadLogs() {
            try {
                const response = await fetch(LOGS_API);
                const data = await response.json();
                const logs = data.logs || [];
                
                if (logs.length > 0) {
                    renderLatestLog(logs[0]);
                }
                
            } catch (error) {
                console.error('ËºâÂÖ•Ë®òÈåÑÂ§±Êïó:', error);
                document.getElementById('latestLog').innerHTML = '<div class="error">ËºâÂÖ•Ë®òÈåÑÂ§±Êïó</div>';
            }
        }
        
        // Êõ¥Êñ∞Áµ±Ë®àË≥áÊñô
        function updateStats(data) {
            document.getElementById('totalPermits').textContent = data.totalCount || 0;
            
            // ÊúÄÊñ∞Âª∫Ê°à
            if (data.permits && data.permits.length > 0) {
                // ÊâæÂá∫ÊúÄÊñ∞ÁöÑÂª∫Ê°àÔºà‰æùindexKeyÊéíÂ∫èÔºâ
                const latestPermit = data.permits.sort((a, b) => 
                    (b.indexKey || '').localeCompare(a.indexKey || '')
                )[0];
                
                if (latestPermit) {
                    document.getElementById('latestPermit').textContent = 
                        latestPermit.permitNumber || '-';
                    document.getElementById('latestPermitApplicant').textContent = 
                        (latestPermit.applicantName || latestPermit.applicant || '-').substring(0, 20) + 
                        (latestPermit.applicantName && latestPermit.applicantName.length > 20 ? '...' : '');
                }
            }
            
            // Áà¨ÂèñÁãÄÊÖã
            document.getElementById('crawlStatus').innerHTML = '‚úÖ Ê≠£Â∏∏';
            document.getElementById('crawlStatus').style.color = '#28a745';
        }
        
        // Ê∏≤ÊüìÊúÄÊñ∞Âü∑Ë°åË®òÈåÑ
        function renderLatestLog(log) {
            // Ë®àÁÆóKEYÁØÑÂúç
            const keyRange = getKeyRangeFromLog(log);
            
            const logHtml = `
                <div class="log-entry">
                    <div class="date">üìÖ ${formatDate(log.date)} ${formatTime(log.startTime)}</div>
                    <div class="details">
                        <div class="detail-item">
                            <span class="detail-label">Âü∑Ë°åÊôÇÈñì</span>
                            <span class="detail-value">${calculateDuration(log.startTime, log.endTime)}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Áà¨ÂèñÁØÑÂúç</span>
                            <span class="detail-value">${keyRange}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Á∏ΩÁà¨ÂèñÊï∏</span>
                            <span class="detail-value">${log.totalCrawled}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Êñ∞Â¢ûË®òÈåÑ</span>
                            <span class="detail-value">${log.newRecords}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">ÈåØË™§Ë®òÈåÑ</span>
                            <span class="detail-value">${log.errorRecords}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Âü∑Ë°åÁãÄÊÖã</span>
                            <span class="detail-value" style="color: ${log.status === 'completed' ? '#28a745' : '#dc3545'}">
                                ${log.status === 'completed' ? 'ÊàêÂäü' : 'Â§±Êïó'}
                            </span>
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('latestLog').innerHTML = logHtml;
        }
        
        // ÂæûÂü∑Ë°åË®òÈåÑË®àÁÆóKEYÁØÑÂúç
        function getKeyRangeFromLog(log) {
            if (log.yearStats) {
                const years = Object.keys(log.yearStats).sort().reverse();
                if (years.length > 0) {
                    const firstYear = years[years.length - 1];
                    const lastYear = years[0];
                    if (firstYear === lastYear) {
                        return `${firstYear}Âπ¥Ë≥áÊñô`;
                    } else {
                        return `${firstYear}-${lastYear}Âπ¥Ë≥áÊñô`;
                    }
                }
            }
            return 'ÁØÑÂúçÊú™Áü•';
        }
        
        // Â°´ÂÖÖË°åÊîøÂçÄÁØ©ÈÅ∏ÈÅ∏È†Ö
        function populateDistrictFilter() {
            const districts = [...new Set(allPermits
                .map(p => extractDistrict(p.siteAddress) || p.district)
                .filter(d => d)
            )].sort();
            
            const select = document.getElementById('districtFilter');
            select.innerHTML = '<option value="">ÂÖ®ÈÉ®ÂçÄÂüü</option>';
            
            districts.forEach(district => {
                const option = document.createElement('option');
                option.value = district;
                option.textContent = district;
                select.appendChild(option);
            });
        }
        
        // Â•óÁî®ÁØ©ÈÅ∏
        function applyFilters() {
            const year = document.getElementById('yearFilter').value;
            const startDate = document.getElementById('startDate').value;
            const endDate = document.getElementById('endDate').value;
            const district = document.getElementById('districtFilter').value;
            const applicantSearchDesktop = document.getElementById('applicantSearchDesktop');
            const applicantSearchMobile = document.getElementById('applicantSearchMobile');
            const applicantSearch = (applicantSearchDesktop?.value || applicantSearchMobile?.value || '').toLowerCase();
            
            filteredPermits = allPermits.filter(permit => {
                // ÂØ∂‰Ω≥ÁØ©ÈÅ∏
                if (baojiFilterActive && !isBaojiaCompany(permit.applicantName)) {
                    return false;
                }
                
                // Âπ¥‰ªΩÁØ©ÈÅ∏
                if (year && permit.permitYear != year) return false;
                
                // Êó•ÊúüÂçÄÈñìÁØ©ÈÅ∏
                if (startDate || endDate) {
                    const permitDate = permit.issueDate || permit.crawledAt?.split('T')[0];
                    if (!permitDate) return false;
                    if (startDate && permitDate < startDate) return false;
                    if (endDate && permitDate > endDate) return false;
                }
                
                // Âú∞ÂçÄÁØ©ÈÅ∏
                if (district) {
                    const permitDistrict = extractDistrict(permit.siteAddress) || permit.district;
                    if (permitDistrict !== district) return false;
                }
                
                // Ëµ∑ÈÄ†‰∫∫ÊêúÂ∞ã
                if (applicantSearch) {
                    const applicantName = (permit.applicantName || '').toLowerCase();
                    if (!applicantName.includes(applicantSearch)) return false;
                }
                
                // AI ÊêúÂ∞ãÊ¢ù‰ª∂ÁØ©ÈÅ∏
                if (aiSearchConditions) {
                    // Âπ¥‰ªΩÁØ©ÈÅ∏ÔºàAIÊêúÂ∞ãÂÑ™ÂÖàÔºâ
                    if (aiSearchConditions.year) {
                        const permitYear = parseInt(permit.indexKey.substring(0, 3));
                        if (permitYear !== aiSearchConditions.year) return false;
                    }
                    
                    // Êúà‰ªΩÁØ©ÈÅ∏
                    if (aiSearchConditions.month_from && permit.issueDate) {
                        const permitMonth = parseInt(permit.issueDate.split('-')[1]);
                        if (permitMonth < aiSearchConditions.month_from) return false;
                    }
                    
                    // Ë°åÊîøÂçÄÁØ©ÈÅ∏ÔºàAIÊêúÂ∞ãÔºâ
                    if (aiSearchConditions.area || aiSearchConditions.areas) {
                        const permitArea = permit.administrativeArea || permit.area || permit.district || '';
                        
                        if (aiSearchConditions.areas) {
                            // Â§öÂÄãÂçÄÂüüÔºåÂè™Ë¶ÅÁ¨¶ÂêàÂÖ∂‰∏≠‰∏ÄÂÄãÂç≥ÂèØ
                            if (!aiSearchConditions.areas.includes(permitArea)) return false;
                        } else if (aiSearchConditions.area) {
                            // ÂñÆ‰∏ÄÂçÄÂüü
                            if (permitArea !== aiSearchConditions.area) return false;
                        }
                    }
                    
                    // Ê®ìÂ±§ÁØ©ÈÅ∏
                    if (aiSearchConditions.floors_min && permit.floors) {
                        if (permit.floors < aiSearchConditions.floors_min) return false;
                    }
                    
                    // Êà∂Êï∏ÁØ©ÈÅ∏
                    if (aiSearchConditions.unit_count_min || aiSearchConditions.unit_count_max) {
                        const unitCount = parseInt(permit.unitCount) || 0;
                        if (aiSearchConditions.unit_count_min && unitCount < aiSearchConditions.unit_count_min) {
                            return false;
                        }
                        if (aiSearchConditions.unit_count_max && unitCount > aiSearchConditions.unit_count_max) {
                            return false;
                        }
                    }
                    
                    // Ê£üÊï∏ÁØ©ÈÅ∏
                    if (aiSearchConditions.building_count_min && permit.buildingCount) {
                        if (parseInt(permit.buildingCount) < aiSearchConditions.building_count_min) return false;
                    }
                    
                    // Á∏ΩÊ®ìÂú∞ÊùøÈù¢Á©çÁØ©ÈÅ∏
                    if (aiSearchConditions.total_area_min && permit.totalFloorArea) {
                        if (parseFloat(permit.totalFloorArea) < aiSearchConditions.total_area_min) return false;
                    }
                    
                    // Âª∫Ë®≠ÂÖ¨Âè∏/Ëµ∑ÈÄ†‰∫∫ÁØ©ÈÅ∏
                    if (aiSearchConditions.applicant_keyword) {
                        const applicant = permit.applicant || permit.applicantName || '';
                        if (!applicant.toLowerCase().includes(aiSearchConditions.applicant_keyword.toLowerCase())) {
                            return false;
                        }
                    }
                }
                
                return true;
            });
            
            currentPage = 1;
            sortPermits();
            renderPermits();
            updateFilterResults();
        }
        
        // Ê∏ÖÈô§ÁØ©ÈÅ∏
        function clearFilters() {
            document.getElementById('yearFilter').value = '';
            document.getElementById('startDate').value = '';
            document.getElementById('endDate').value = '';
            document.getElementById('districtFilter').value = '';
            document.getElementById('applicantSearch').value = '';
            
            filteredPermits = [...allPermits];
            currentPage = 1;
            sortPermits();
            renderPermits();
            updateFilterResults();
        }
        
        // ÊêúÂ∞ãËµ∑ÈÄ†‰∫∫
        function searchApplicant(query, source = 'desktop') {
            // ÂêåÊ≠•ÂÖ©ÂÄãËº∏ÂÖ•Ê°ÜÁöÑÂÄº
            if (source === 'desktop') {
                const mobileInput = document.getElementById('applicantSearchMobile');
                if (mobileInput) mobileInput.value = query;
            } else {
                const desktopInput = document.getElementById('applicantSearchDesktop');
                if (desktopInput) desktopInput.value = query;
            }
            applyFilters();
        }
        
        // Ê∏ÖÈô§ÊêúÂ∞ã
        function clearSearch() {
            document.getElementById('applicantSearchDesktop').value = '';
            document.getElementById('applicantSearchMobile').value = '';
            document.getElementById('aiSearchInputDesktop').value = '';
            document.getElementById('aiSearchInputMobile').value = '';
            document.getElementById('aiSearchResultsDesktop').innerHTML = '';
            document.getElementById('aiSearchResultsMobile').innerHTML = '';
            aiSearchConditions = null;
            applyFilters();
        }
        
        // Claude API Êô∫ÊÖßÊêúÂ∞ãÂäüËÉΩ
        let aiSearchConditions = null;
        
        async function performAISearch(source = 'desktop') {
            const inputId = source === 'desktop' ? 'aiSearchInputDesktop' : 'aiSearchInputMobile';
            const btnId = source === 'desktop' ? 'aiSearchBtnDesktop' : 'aiSearchBtnMobile';
            const resultsId = source === 'desktop' ? 'aiSearchResultsDesktop' : 'aiSearchResultsMobile';
            
            const input = document.getElementById(inputId);
            const btn = document.getElementById(btnId);
            const query = input.value.trim();
            
            // ÂêåÊ≠•ÂÖ©ÂÄãËº∏ÂÖ•Ê°ÜÁöÑÂÄº
            const otherInputId = source === 'desktop' ? 'aiSearchInputMobile' : 'aiSearchInputDesktop';
            const otherInput = document.getElementById(otherInputId);
            if (otherInput) otherInput.value = query;
            
            // Â¶ÇÊûúÂãæÈÅ∏ÂØ∂‰Ω≥ÁØ©ÈÅ∏ÔºåÂÖÅË®±Á©∫ÁôΩÊêúÂ∞ã
            if (!query && !baojiFilterActive) {
                alert('Ë´ãËº∏ÂÖ•ÊêúÂ∞ãÂÖßÂÆπ');
                return;
            }
            
            // È°ØÁ§∫ËºâÂÖ•‰∏≠
            btn.disabled = true;
            btn.innerHTML = '<span>üîÑ</span><span>ÊêúÂ∞ã‰∏≠...</span>';
            
            try {
                // ‰ΩøÁî®Â¢ûÂº∑ÁâàÊú¨Âú∞Ëß£ÊûêÂô®ÔºàGPT API È°çÂ∫¶Áî®ÂÆåÊôÇÁöÑÂÇôÊ°àÔºâ
                const useEnhancedParser = true;
                
                if (useEnhancedParser) {
                    // ‰ΩøÁî®Êõ¥Êô∫ÊÖßÁöÑÊú¨Âú∞Ëß£Êûê
                    const conditions = parseNaturalLanguageQueryEnhanced(query);
                    if (conditions) {
                        aiSearchConditions = conditions;
                        applyAISearchFilters();
                        showSearchConditions(conditions);
                        console.log('Â¢ûÂº∑Ëß£ÊûêÁµêÊûú:', conditions);
                        return;
                    }
                }
                
                // ‰ΩøÁî®Êú¨Âú∞Ëß£Êûê
                const conditions = parseNaturalLanguageQuery(query);
                if (conditions) {
                    aiSearchConditions = conditions;
                    applyAISearchFilters();
                    showSearchConditions(conditions);
                }
            } catch (error) {
                console.error('ÊêúÂ∞ãÈåØË™§:', error);
                alert('ÊêúÂ∞ãÂ§±ÊïóÔºåË´ãÁ®çÂæåÂÜçË©¶');
            } finally {
                btn.disabled = false;
                btn.innerHTML = '<span>ü§ñ</span><span>Êô∫ÊÖßÊêúÂ∞ã</span>';
            }
        }
        
        // Â¢ûÂº∑ÁâàÊú¨Âú∞Ëß£ÊûêÂáΩÊï∏
        function parseNaturalLanguageQueryEnhanced(query) {
            const conditions = {};
            
            // Ê®ôÊ∫ñÂåñÊü•Ë©¢
            let normalizedQuery = query.toLowerCase();
            normalizedQuery = normalizedQuery.replace(/(\d+)([^\d\s])/g, '$1 $2');
            normalizedQuery = normalizedQuery.replace(/([^\d\s])(\d+)/g, '$1 $2');
            
            console.log('Â¢ûÂº∑Ëß£Êûê - Ê®ôÊ∫ñÂåñÊü•Ë©¢:', normalizedQuery);
            
            // Êô∫ÊÖßËß£ÊûêÂ§öÊ¢ù‰ª∂ÁµÑÂêà
            // ËôïÁêÜ "113Âπ¥Âú®Â§ßÈáåÂçÄ230Êà∂‰ª•‰∏ä" ÈÄôÁ®ÆË§áÈõúÊü•Ë©¢
            
            // 1. Âπ¥‰ªΩËß£ÊûêÔºàÊîØÊè¥Â§öÁ®ÆÊ†ºÂºèÔºâ
            const yearPatterns = [
                /(\d{3})\s*Âπ¥/,
                /Ê∞ëÂúã\s*(\d{3})/,
                /‰ªäÂπ¥/,
                /ÂéªÂπ¥/,
                /ÂâçÂπ¥/
            ];
            
            for (const pattern of yearPatterns) {
                const match = normalizedQuery.match(pattern);
                if (match) {
                    if (match[0] === '‰ªäÂπ¥') {
                        conditions.year = 113;
                    } else if (match[0] === 'ÂéªÂπ¥') {
                        conditions.year = 112;
                    } else if (match[0] === 'ÂâçÂπ¥') {
                        conditions.year = 111;
                    } else if (match[1]) {
                        conditions.year = parseInt(match[1]);
                    }
                    break;
                }
            }
            
            // 2. Êúà‰ªΩËß£ÊûêÔºàÊîØÊè¥ÁØÑÂúçÔºâ
            const monthPatterns = [
                /(\d{1,2})\s*Êúà\s*‰ª•Âæå/,
                /(\d{1,2})\s*Êúà\s*‰πãÂæå/,
                /(\d{1,2})\s*Êúà\s*Ëµ∑/,
                /(\d{1,2})\s*[-~Âà∞Ëá≥]\s*(\d{1,2})\s*Êúà/,
                /Á¨¨\s*([‰∏Ä‰∫å‰∏âÂõõ])\s*Â≠£/
            ];
            
            for (const pattern of monthPatterns) {
                const match = normalizedQuery.match(pattern);
                if (match) {
                    if (match[0].includes('Â≠£')) {
                        const quarterMap = {'‰∏Ä': 1, '‰∫å': 4, '‰∏â': 7, 'Âõõ': 10};
                        const quarter = quarterMap[match[1]];
                        if (quarter) {
                            conditions.month_from = quarter;
                            conditions.month_to = quarter + 2;
                        }
                    } else if (match[2]) {
                        conditions.month_from = parseInt(match[1]);
                        conditions.month_to = parseInt(match[2]);
                    } else if (match[1]) {
                        conditions.month_from = parseInt(match[1]);
                    }
                    break;
                }
            }
            
            // 3. Ë°åÊîøÂçÄËß£ÊûêÔºàÊõ¥Êô∫ÊÖßÔºâ
            const areas = ['ÂåóÂ±ØÂçÄ', 'Ë•øÂ±ØÂçÄ', 'ÂçóÂ±ØÂçÄ', 'Ë•øÂçÄ', 'ÂåóÂçÄ', 'ÂçóÂçÄ', 'Êù±ÂçÄ', '‰∏≠ÂçÄ', 
                          'Â§™Âπ≥ÂçÄ', 'Â§ßÈáåÂçÄ', 'ÈúßÂ≥∞ÂçÄ', 'ÁÉèÊó•ÂçÄ', 'Ë±êÂéüÂçÄ', 'ÊΩ≠Â≠êÂçÄ', 'Â§ßÈõÖÂçÄ', 
                          'Á•ûÂ≤°ÂçÄ', 'ÂêéÈáåÂçÄ', 'Êù±Âã¢ÂçÄ', 'ÂíåÂπ≥ÂçÄ', 'Êñ∞Á§æÂçÄ', 'Áü≥Â≤°ÂçÄ', 'Â§ñÂüîÂçÄ', 
                          'Â§ßÂÆâÂçÄ', 'Ê∏ÖÊ∞¥ÂçÄ', 'Ê≤ôÈπøÂçÄ', 'Èæç‰∫ïÂçÄ', 'Ê¢ßÊ£≤ÂçÄ', 'Â§ßËÇöÂçÄ', 'Â§ßÁî≤ÂçÄ'];
            
            // Â∞ãÊâæË°åÊîøÂçÄ - ÊîØÊè¥Â§öÂÄãÂçÄÂüü
            let foundAreas = [];
            let remainingQuery = query;
            
            // 1. ÊâæÂÆåÊï¥ÂåπÈÖçÔºàÂ¶Ç"ÂåóÂ±ØÂçÄ"Ôºâ
            for (const area of areas) {
                if (remainingQuery.includes(area)) {
                    foundAreas.push(area);
                    remainingQuery = remainingQuery.replace(area, ' '); // ÊõøÊèõÁÇ∫Á©∫Ê†ºÈÅøÂÖçÈáçË§áÂåπÈÖç
                }
            }
            
            // 2. ÊâæÈÉ®ÂàÜÂåπÈÖçÔºàÂ¶Ç"ÂåóÂ±Ø"‚Üí"ÂåóÂ±ØÂçÄ"Ôºâ
            // ÊåâÈï∑Â∫¶ÊéíÂ∫èÔºåÈï∑ÁöÑÂÑ™ÂÖàÂåπÈÖç
            const sortedAreas = [...areas].sort((a, b) => b.length - a.length);
            for (const area of sortedAreas) {
                const shortArea = area.replace('ÂçÄ', '');
                if (shortArea.length > 1 && remainingQuery.includes(shortArea)) {
                    // Ê™¢Êü•ÊòØÂê¶Â∑≤Á∂ìÂú®foundAreas‰∏≠
                    if (!foundAreas.includes(area)) {
                        foundAreas.push(area);
                        remainingQuery = remainingQuery.replace(shortArea, ' ');
                    }
                }
            }
            
            // Ë®≠ÂÆöÂçÄÂüüÊ¢ù‰ª∂
            if (foundAreas.length === 1) {
                conditions.area = foundAreas[0];
            } else if (foundAreas.length > 1) {
                conditions.areas = foundAreas; // Â§öÂÄãÂçÄÂüü
                // ‰∏çË®≠ÂÆö areaÔºåÂè™Áî® areas
            }
            
            // 4. Êà∂Êï∏Ëß£ÊûêÔºàÊîØÊè¥ÂêÑÁ®ÆË°®ÈÅîÔºâ
            const unitPatterns = [
                /(\d+)\s*[-~Âà∞Ëá≥]\s*(\d+)\s*Êà∂/,
                /(\d+)\s*Êà∂\s*‰ª•‰∏ä/,
                /(\d+)\s*Êà∂\s*‰ª•‰∏ã/,
                /Ë∂ÖÈÅé\s*(\d+)\s*Êà∂/,
                /Â§ßÊñº\s*(\d+)\s*Êà∂/,
                /Â∞èÊñº\s*(\d+)\s*Êà∂/
            ];
            
            for (const pattern of unitPatterns) {
                const match = normalizedQuery.match(pattern);
                if (match) {
                    if (match[0].includes('‰ª•‰∏ä') || match[0].includes('Ë∂ÖÈÅé') || match[0].includes('Â§ßÊñº')) {
                        conditions.unit_count_min = parseInt(match[1]);
                    } else if (match[0].includes('‰ª•‰∏ã') || match[0].includes('Â∞èÊñº')) {
                        conditions.unit_count_max = parseInt(match[1]);
                    } else if (match[2]) {
                        conditions.unit_count_min = parseInt(match[1]);
                        conditions.unit_count_max = parseInt(match[2]);
                    }
                    break;
                }
            }
            
            // 5. Ê®ìÂ±§Ëß£Êûê
            const floorPatterns = [
                /(\d+)\s*[-~Âà∞Ëá≥]\s*(\d+)\s*Ê®ì/,
                /(\d+)\s*Ê®ì\s*‰ª•‰∏ä/,
                /(\d+)\s*Ê®ì\s*‰ª•‰∏ã/,
                /Ë∂ÖÈÅé\s*(\d+)\s*Ê®ì/,
                /È´òÊñº\s*(\d+)\s*Ê®ì/
            ];
            
            for (const pattern of floorPatterns) {
                const match = normalizedQuery.match(pattern);
                if (match) {
                    if (match[0].includes('‰ª•‰∏ä') || match[0].includes('Ë∂ÖÈÅé') || match[0].includes('È´òÊñº')) {
                        conditions.floors_min = parseInt(match[1]);
                    } else if (match[0].includes('‰ª•‰∏ã')) {
                        conditions.floors_max = parseInt(match[1]);
                    } else if (match[2]) {
                        conditions.floors_min = parseInt(match[1]);
                        conditions.floors_max = parseInt(match[2]);
                    }
                    break;
                }
            }
            
            // 6. Âª∫Ë®≠ÂÖ¨Âè∏/Ëµ∑ÈÄ†‰∫∫ÈóúÈçµÂ≠óËß£Êûê
            const companyKeywords = [
                'Âª∫Ë®≠', 'ÈñãÁôº', 'ÁáüÈÄ†', 'Âª∫ÁØâ', 'Âú∞Áî¢', '‰∏çÂãïÁî¢', 'Âª∫Ê•≠',
                'ËààÊ•≠', 'Âª∫ÂïÜ', 'Âª∫Ë®≠ÂÖ¨Âè∏', 'ÈñãÁôºÂÖ¨Âè∏', 'ÁáüÈÄ†ÂÖ¨Âè∏'
            ];
            
            // ÊâæÂá∫ÂèØËÉΩÁöÑÂÖ¨Âè∏ÂêçÁ®±
            let companyName = '';
            
            // Ê™¢Êü•ÊòØÂê¶ÊúâÊòéÁ¢∫ÁöÑÂÖ¨Âè∏ÈóúÈçµÂ≠ó
            for (const keyword of companyKeywords) {
                if (normalizedQuery.includes(keyword)) {
                    // ÂòóË©¶ÊèêÂèñÂÖ¨Âè∏ÂêçÁ®±
                    const regex = new RegExp(`([\\u4e00-\\u9fa5a-zA-Z\\d]{2,10})(${keyword})`, 'g');
                    const match = regex.exec(query);
                    if (match) {
                        companyName = match[1] + match[2];
                        break;
                    }
                }
            }
            
            // Â¶ÇÊûúÊ≤íÊâæÂà∞ÊòéÁ¢∫ÁöÑÂÖ¨Âè∏ÈóúÈçµÂ≠óÔºåÊ™¢Êü•Â∏∏Ë¶ãÂª∫Ë®≠ÂÖ¨Âè∏ÂêçÁ®±Ê®°Âºè
            if (!companyName) {
                const commonCompanies = [
                    'Â§™Â≠ê', 'ÈÅ†ÈõÑ', 'ËààÂØåÁôº', 'Èï∑Ëôπ', 'ËèØÂõ∫', 'ÂúãÊ≥∞', 'ÂØåÈÇ¶', 'ÂÆèÊôÆ',
                    'ÊÉ†ÂÆá', 'È†ÜÂ§©', 'ËÅØËÅö', 'Á≤æÈä≥', 'ÂØ∂Ëºù', 'ÈæçÈÇ¶', '‰Ω≥Á¶è', 'ÈâÖËôπ',
                    'Ë±êÈÇë', 'ÂØ∂ÁíΩ', 'Êñ∞Ê•≠', 'ÂÖÅÂ∞á', 'Â§ßÂüé', 'ÂÆèÁõõ', 'Âæ∑ÂÆâ', 'Ê´ªËä±'
                ];
                
                for (const company of commonCompanies) {
                    if (query.includes(company)) {
                        companyName = company;
                        break;
                    }
                }
            }
            
            if (companyName) {
                conditions.applicant_keyword = companyName;
            }
            
            // 7. ÁâπÊÆäÈóúÈçµÂ≠óËôïÁêÜ
            if (normalizedQuery.includes('Ë±™ÂÆÖ')) {
                conditions.unit_count_max = conditions.unit_count_max || 100;
                conditions.floors_min = conditions.floors_min || 15;
                conditions.total_area_min = conditions.total_area_min || 10000;
            }
            
            if (normalizedQuery.includes('ÈÄèÂ§©')) {
                conditions.floors_max = conditions.floors_max || 5;
                // ÈÄèÂ§©ÂÆöÁæ©Ôºö5Â±§Ê®ì‰ª•‰∏ãÁöÑÊàøÂ≠êÔºà‰∏çÈôêÂà∂Êà∂Êï∏Ôºâ
            }
            
            if (normalizedQuery.includes('Â§ßÂûã') || normalizedQuery.includes('Â§ßÊ®ì')) {
                conditions.unit_count_min = conditions.unit_count_min || 50;
                conditions.floors_min = conditions.floors_min || 10;
            }
            
            console.log('Â¢ûÂº∑Ëß£Êûê - ÂéüÂßãÊü•Ë©¢:', query);
            console.log('Â¢ûÂº∑Ëß£Êûê - Ê®ôÊ∫ñÂåñÊü•Ë©¢:', normalizedQuery);
            console.log('Â¢ûÂº∑Ëß£Êûê - ÊâæÂà∞ÁöÑÂçÄÂüü:', foundAreas);
            console.log('Â¢ûÂº∑Ëß£Êûê - ÊúÄÁµÇÁµêÊûú:', conditions);
            return Object.keys(conditions).length > 0 ? conditions : null;
        }
        
        // Êú¨Âú∞Ëß£ÊûêÂáΩÊï∏ÔºàÁî®ÊñºÊ∏¨Ë©¶Ôºâ
        function parseNaturalLanguageQuery(query) {
            const conditions = {};
            
            // ÂÖàÂ∞áÊü•Ë©¢Â≠ó‰∏≤Ê®ôÊ∫ñÂåñÔºàÂä†ÂÖ•Á©∫Ê†º‰ª•‰æøËß£ÊûêÔºâ
            let normalizedQuery = query;
            // Âú®Êï∏Â≠óÂíå‰∏≠Êñá‰πãÈñìÂä†ÂÖ•Á©∫Ê†º
            normalizedQuery = normalizedQuery.replace(/(\d+)([^\d\s])/g, '$1 $2');
            normalizedQuery = normalizedQuery.replace(/([^\d\s])(\d+)/g, '$1 $2');
            
            console.log('Ê®ôÊ∫ñÂåñÊü•Ë©¢:', normalizedQuery);
            
            // Ëß£ÊûêÂπ¥‰ªΩ
            const yearMatch = normalizedQuery.match(/(\d{3})\s*Âπ¥/);
            if (yearMatch) {
                conditions.year = parseInt(yearMatch[1]);
            }
            
            // Ëß£ÊûêÊúà‰ªΩ
            const monthMatch = normalizedQuery.match(/(\d{1,2})\s*Êúà/);
            if (monthMatch) {
                conditions.month_from = parseInt(monthMatch[1]);
            }
            
            // Ëß£ÊûêË°åÊîøÂçÄ - ‰ΩøÁî®Êõ¥Á≤æÁ¢∫ÁöÑÂåπÈÖç
            const areas = ['ÂåóÂ±ØÂçÄ', 'Ë•øÂ±ØÂçÄ', 'ÂçóÂ±ØÂçÄ', 'Ë•øÂçÄ', 'ÂåóÂçÄ', 'ÂçóÂçÄ', 'Êù±ÂçÄ', '‰∏≠ÂçÄ', 
                          'Â§™Âπ≥ÂçÄ', 'Â§ßÈáåÂçÄ', 'ÈúßÂ≥∞ÂçÄ', 'ÁÉèÊó•ÂçÄ', 'Ë±êÂéüÂçÄ', 'ÊΩ≠Â≠êÂçÄ', 'Â§ßÈõÖÂçÄ', 
                          'Á•ûÂ≤°ÂçÄ', 'ÂêéÈáåÂçÄ', 'Êù±Âã¢ÂçÄ', 'ÂíåÂπ≥ÂçÄ', 'Êñ∞Á§æÂçÄ', 'Áü≥Â≤°ÂçÄ', 'Â§ñÂüîÂçÄ', 
                          'Â§ßÂÆâÂçÄ', 'Ê∏ÖÊ∞¥ÂçÄ', 'Ê≤ôÈπøÂçÄ', 'Èæç‰∫ïÂçÄ', 'Ê¢ßÊ£≤ÂçÄ', 'Â§ßËÇöÂçÄ', 'Â§ßÁî≤ÂçÄ'];
            
            // Â∞ãÊâæÊâÄÊúâÂåπÈÖçÁöÑË°åÊîøÂçÄÔºà‰ª•ÊúÄÂæå‰∏ÄÂÄãÁÇ∫Ê∫ñÔºâ
            let foundArea = null;
            for (const area of areas) {
                if (query.includes(area)) {
                    foundArea = area;
                }
            }
            if (foundArea) {
                conditions.area = foundArea;
            }
            
            // Ëß£ÊûêÊ®ìÂ±§ - ÊîØÊè¥ÂçÄÈñì
            const floorRangeMatch = normalizedQuery.match(/(\d+)\s*[-~Âà∞Ëá≥]\s*(\d+)\s*Ê®ì/);
            const floorMinMatch = normalizedQuery.match(/(\d+)\s*Ê®ì‰ª•‰∏ä/);
            const floorMaxMatch = normalizedQuery.match(/(\d+)\s*Ê®ì‰ª•‰∏ã/);
            
            if (floorRangeMatch) {
                conditions.floors_min = parseInt(floorRangeMatch[1]);
                conditions.floors_max = parseInt(floorRangeMatch[2]);
            } else if (floorMinMatch) {
                conditions.floors_min = parseInt(floorMinMatch[1]);
            } else if (floorMaxMatch) {
                conditions.floors_max = parseInt(floorMaxMatch[1]);
            }
            
            // Ëß£ÊûêÊà∂Êï∏ - ÊîØÊè¥ÂçÄÈñìÂíå‰ª•‰∏ä
            const unitRangeMatch = normalizedQuery.match(/(\d+)\s*[-~Âà∞Ëá≥]\s*(\d+)\s*Êà∂/);
            const unitMinMatch = normalizedQuery.match(/(\d+)\s*Êà∂‰ª•‰∏ä/);
            const unitMaxMatch = normalizedQuery.match(/(\d+)\s*Êà∂‰ª•‰∏ã/);
            
            if (unitRangeMatch) {
                conditions.unit_count_min = parseInt(unitRangeMatch[1]);
                conditions.unit_count_max = parseInt(unitRangeMatch[2]);
            } else if (unitMinMatch) {
                conditions.unit_count_min = parseInt(unitMinMatch[1]);
            } else if (unitMaxMatch) {
                conditions.unit_count_max = parseInt(unitMaxMatch[1]);
            }
            
            // Ëß£ÊûêÊ£üÊï∏
            const buildingMatch = normalizedQuery.match(/(\d+)\s*Ê£ü‰ª•‰∏ä/);
            if (buildingMatch) {
                conditions.building_count_min = parseInt(buildingMatch[1]);
            }
            
            // Ëß£ÊûêÁ∏ΩÊ®ìÂú∞ÊùøÈù¢Á©ç
            const areaMatch = normalizedQuery.match(/(\d+)\s*Âπ≥ÊñπÂÖ¨Â∞∫‰ª•‰∏ä|(\d+)\s*Âù™‰ª•‰∏ä/);
            if (areaMatch) {
                if (normalizedQuery.includes('Âù™')) {
                    // 1Âù™ = 3.306Âπ≥ÊñπÂÖ¨Â∞∫
                    conditions.total_area_min = parseInt(areaMatch[2]) * 3.306;
                } else {
                    conditions.total_area_min = parseInt(areaMatch[1]);
                }
            }
            
            console.log('Ëß£ÊûêÊ¢ù‰ª∂:', conditions);
            return conditions;
        }
        
        // Â•óÁî® AI ÊêúÂ∞ãÁØ©ÈÅ∏
        function applyAISearchFilters() {
            console.log('AIÊêúÂ∞ãÊ¢ù‰ª∂:', aiSearchConditions);
            // Áõ¥Êé•ÂëºÂè´‰∏ªË¶ÅÁöÑÁØ©ÈÅ∏ÂáΩÊï∏ÔºåÂÆÉÊúÉÊ™¢Êü• aiSearchConditions
            applyFilters();
            
            // Èô§ÈåØÔºöÈ°ØÁ§∫Ââç5Á≠ÜÁ¨¶ÂêàÁöÑË≥áÊñô
            if (filteredPermits.length > 0) {
                console.log('Á¨¶ÂêàÊ¢ù‰ª∂ÁöÑÂâç5Á≠ÜË≥áÊñô:');
                filteredPermits.slice(0, 5).forEach(p => {
                    console.log(`${p.permitNumber} - Êà∂Êï∏: ${p.unitCount}`);
                });
            }
        }
        
        // È°ØÁ§∫ÊêúÂ∞ãÊ¢ù‰ª∂
        function showSearchConditions(conditions) {
            let conditionText = 'ÊêúÂ∞ãÊ¢ù‰ª∂Ôºö';
            if (conditions.year) conditionText += `${conditions.year}Âπ¥ `;
            if (conditions.month_from) conditionText += `${conditions.month_from}Êúà‰ª•Âæå `;
            if (conditions.areas) {
                conditionText += `${conditions.areas.join('„ÄÅ')} `;
            } else if (conditions.area) {
                conditionText += `${conditions.area} `;
            }
            if (conditions.applicant_keyword) conditionText += `Âª∫Ë®≠ÂÖ¨Âè∏Ôºö${conditions.applicant_keyword} `;
            if (conditions.floors_min) conditionText += `${conditions.floors_min}Ê®ì‰ª•‰∏ä `;
            if (conditions.unit_count_min && conditions.unit_count_max) {
                conditionText += `${conditions.unit_count_min}-${conditions.unit_count_max}Êà∂ `;
            } else if (conditions.unit_count_min) {
                conditionText += `${conditions.unit_count_min}Êà∂‰ª•‰∏ä `;
            } else if (conditions.unit_count_max) {
                conditionText += `${conditions.unit_count_max}Êà∂‰ª•‰∏ã `;
            }
            if (conditions.building_count_min) conditionText += `${conditions.building_count_min}Ê£ü‰ª•‰∏ä `;
            if (conditions.total_area_min) conditionText += `${Math.round(conditions.total_area_min)}Âπ≥ÊñπÂÖ¨Â∞∫‰ª•‰∏ä `;
            
            const filterResults = document.getElementById('filterResults');
            filterResults.innerHTML = `<strong>${conditionText}</strong><br>${filterResults.textContent}`;
        }
        
        // Ê∏ÖÈô§ AI ÊêúÂ∞ã
        function clearAISearch() {
            document.getElementById('aiSearchInput').value = '';
            aiSearchConditions = null;
            applyFilters();
        }
        
        // Êõ¥Êñ∞ÁØ©ÈÅ∏ÁµêÊûú
        function updateFilterResults() {
            const total = allPermits.length;
            const filtered = filteredPermits.length;
            const resultText = filtered < total ? 
                `È°ØÁ§∫ ${filtered} Á≠ÜÁµêÊûúÔºàÂÖ± ${total} Á≠ÜÔºâ` : 
                `È°ØÁ§∫ÂÖ®ÈÉ® ${total} Á≠ÜÁµêÊûú`;
            
            document.getElementById('filterResults').textContent = resultText;
        }
        
        // ÊéíÂ∫è
        function sortBy(key) {
            if (sortConfig.key === key) {
                sortConfig.direction = sortConfig.direction === 'asc' ? 'desc' : 'asc';
            } else {
                sortConfig.key = key;
                sortConfig.direction = key === 'permitNumber' ? 'desc' : 'asc';
            }
            
            sortPermits();
            renderPermits();
        }
        
        // Âü∑Ë°åÊéíÂ∫è
        function sortPermits() {
            filteredPermits.sort((a, b) => {
                let aVal = a[sortConfig.key];
                let bVal = b[sortConfig.key];
                
                // ËôïÁêÜÂª∫ÁÖßËôüÁ¢ºÊéíÂ∫è
                if (sortConfig.key === 'permitNumber') {
                    // ÊèêÂèñÂπ¥‰ªΩÂíåÂ∫èËôüÈÄ≤Ë°åÊï∏ÂÄºÊéíÂ∫è
                    const aMatch = (aVal || '').match(/(\d+)‰∏≠.*Á¨¨(\d+)Ëôü/);
                    const bMatch = (bVal || '').match(/(\d+)‰∏≠.*Á¨¨(\d+)Ëôü/);
                    
                    if (aMatch && bMatch) {
                        const aYear = parseInt(aMatch[1]);
                        const bYear = parseInt(bMatch[1]);
                        const aSeq = parseInt(aMatch[2]);
                        const bSeq = parseInt(bMatch[2]);
                        
                        if (aYear !== bYear) {
                            return sortConfig.direction === 'desc' ? bYear - aYear : aYear - bYear;
                        }
                        return sortConfig.direction === 'desc' ? bSeq - aSeq : aSeq - bSeq;
                    }
                }
                
                // ËôïÁêÜÊï∏ÂÄºÊéíÂ∫è
                if (typeof aVal === 'number' && typeof bVal === 'number') {
                    return sortConfig.direction === 'desc' ? bVal - aVal : aVal - bVal;
                }
                
                // ËôïÁêÜÂ≠ó‰∏≤ÊéíÂ∫è
                aVal = String(aVal || '');
                bVal = String(bVal || '');
                
                if (sortConfig.direction === 'desc') {
                    return bVal.localeCompare(aVal, 'zh-TW');
                } else {
                    return aVal.localeCompare(bVal, 'zh-TW');
                }
            });
        }
        
        // Ê∏≤ÊüìÂª∫ÁÖßÂàóË°®
        function renderPermits() {
            const container = document.getElementById('permitsList');
            
            if (filteredPermits.length === 0) {
                container.innerHTML = '<div class="error">Ê≤íÊúâÁ¨¶ÂêàÊ¢ù‰ª∂ÁöÑË≥áÊñô</div>';
                return;
            }
            
            const tableHtml = `
                <table class="permits-table">
                    <thead class="table-header">
                        <tr>
                            <th class="sortable" onclick="sortBy('permitNumber')" 
                                data-sort="${sortConfig.key === 'permitNumber' ? 'sort-' + sortConfig.direction : ''}">
                                Âª∫ÈÄ†Âü∑ÁÖßËôüÁ¢º
                            </th>
                            <th class="clickable">Ëµ∑ÈÄ†‰∫∫</th>
                            <th>Âú∞Ëôü</th>
                            <th class="clickable">Ë°åÊîøÂçÄ</th>
                            <th class="sortable" onclick="sortBy('floors')"
                                data-sort="${sortConfig.key === 'floors' ? 'sort-' + sortConfig.direction : ''}">
                                Ê®ìÂ±§
                            </th>
                            <th class="sortable" onclick="sortBy('buildingCount')"
                                data-sort="${sortConfig.key === 'buildingCount' ? 'sort-' + sortConfig.direction : ''}">
                                Ê£üÊï∏
                            </th>
                            <th class="sortable" onclick="sortBy('unitCount')"
                                data-sort="${sortConfig.key === 'unitCount' ? 'sort-' + sortConfig.direction : ''}">
                                Êà∂Êï∏
                            </th>
                            <th class="sortable" onclick="sortBy('totalFloorArea')"
                                data-sort="${sortConfig.key === 'totalFloorArea' ? 'sort-' + sortConfig.direction : ''}">
                                Á∏ΩÊ®ìÂú∞ÊùøÈù¢Á©ç
                            </th>
                            <th class="sortable" onclick="sortBy('issueDate')"
                                data-sort="${sortConfig.key === 'issueDate' ? 'sort-' + sortConfig.direction : ''}">
                                ÁôºÁÖßÊó•Êúü
                            </th>
                            <th style="text-align: center;">Ë©≥ÊÉÖ</th>
                            <th style="text-align: center;">ÈÄ£Áµê</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${renderTableRows()}
                    </tbody>
                </table>
            `;
            
            container.innerHTML = `
                <div class="table-container">
                    ${tableHtml}
                </div>
            `;
            updateSortIcons();
            updatePagination();
        }
        
        // Ê∏≤ÊüìË°®Ê†ºË°å
        function renderTableRows() {
            const startIndex = (currentPage - 1) * pageSize;
            const endIndex = startIndex + pageSize;
            return filteredPermits.slice(startIndex, endIndex).map(permit => {
                const landNumber = extractLandNumber(permit.siteAddress);
                const district = extractDistrict(permit.siteAddress) || permit.district || '-';
                const permitNumber = permit.permitNumber || 'Êú™Áü•';
                const totalFloorArea = permit.totalFloorArea ? 
                    (typeof permit.totalFloorArea === 'number' ? 
                        permit.totalFloorArea.toLocaleString() + ' m¬≤' : 
                        permit.totalFloorArea + ' m¬≤') : '-';
                const issueDate = permit.issueDate ? formatDate(permit.issueDate) : '-';
                
                const isBaojia = isBaojiaCompany(permit.applicantName);
                return `
                    <tr class="table-row">
                        <td class="permit-number">${permitNumber}</td>
                        <td class="applicant-cell" onclick="searchByApplicant('${(permit.applicantName || '').replace(/'/g, "\\'")}')">
                            ${permit.applicantName || '-'}
                            ${isBaojia ? '<span style="background: #e74c3c; color: white; padding: 2px 6px; border-radius: 10px; font-size: 10px; margin-left: 5px;">ÂØ∂‰Ω≥</span>' : ''}
                        </td>
                        <td>${landNumber}</td>
                        <td class="district-cell" onclick="filterByDistrict('${district}')">${district}</td>
                        <td class="number-cell">${permit.floors || '-'}</td>
                        <td class="number-cell">${permit.buildingCount || '-'}</td>
                        <td class="number-cell">${permit.unitCount || '-'}</td>
                        <td class="area-cell">${totalFloorArea}</td>
                        <td class="date-cell">${issueDate}</td>
                        <td style="text-align: center;">
                            <div style="display: flex; flex-direction: column; gap: 5px; align-items: center;">
                                <a href="https://objectstorage.ap-tokyo-1.oraclecloud.com/n/nrsdi1rz5vl8/b/taichung-building-permits/o/html/${permit.indexKey}.html" 
                                   target="_blank" class="btn-detail">ÂéüÊ™î</a>
                                <button class="btn-detail" onclick="showPermitDetail('${permit.indexKey}')">Ë©≥ÊÉÖ</button>
                            </div>
                        </td>
                        <td style="text-align: center;">
                            <a href="https://mcgbm.taichung.gov.tw/bupic/pages/queryInfoAction.do?INDEX_KEY=${permit.indexKey}" 
                               target="_blank" class="btn-link">ÊîøÂ∫úÁ∂≤Á´ô</a>
                        </td>
                    </tr>
                `;
            }).join('');
        }
        
        // Êõ¥Êñ∞ÊéíÂ∫èÂúñÁ§∫
        function updateSortIcons() {
            document.querySelectorAll('.table-header th').forEach(th => {
                th.classList.remove('sort-asc', 'sort-desc');
                if (th.onclick && th.onclick.toString().includes(sortConfig.key)) {
                    th.classList.add('sort-' + sortConfig.direction);
                }
            });
        }
        
        // ÊåâËµ∑ÈÄ†‰∫∫ÊêúÂ∞ã
        function searchByApplicant(applicantName) {
            // ÊèêÂèñÈóúÈçµÂ≠óÔºàÂéªÈô§ÂÖ¨Âè∏ÂæåÁ∂¥Á≠âÔºâ
            let keyword = applicantName;
            const companyKeywords = ['ËÇ°‰ªΩÊúâÈôêÂÖ¨Âè∏', 'ÊúâÈôêÂÖ¨Âè∏', 'Ë≤†Ë≤¨‰∫∫', '‰ª£Ë°®‰∫∫', 'Á≠âÂ¶ÇÈôÑË°®'];
            
            for (const ck of companyKeywords) {
                if (keyword.includes(ck)) {
                    const parts = keyword.split(ck);
                    keyword = parts[0].trim();
                    break;
                }
            }
            
            // ÈÄ≤‰∏ÄÊ≠•ÊèêÂèñÊ†∏ÂøÉÂêçÁ®±
            if (keyword.includes(':')) {
                keyword = keyword.split(':')[1].trim();
            }
            
            // Âè™ÂèñÂâçÂπæÂÄãÂ≠ó
            if (keyword.length > 4) {
                keyword = keyword.substring(0, 4);
            }
            
            document.getElementById('applicantSearch').value = keyword;
            applyFilters();
        }
        
        // ÊåâË°åÊîøÂçÄÁØ©ÈÅ∏
        function filterByDistrict(district) {
            document.getElementById('districtFilter').value = district;
            applyFilters();
        }
        
        // È°ØÁ§∫Âª∫ÁÖßË©≥Á¥∞Ë≥áÊñô
        function showPermitDetail(indexKey) {
            const permit = allPermits.find(p => p.indexKey === indexKey);
            if (!permit) return;
            
            document.getElementById('modalTitle').textContent = permit.permitNumber || 'Âª∫ÁÖßË©≥Á¥∞Ë≥áÊñô';
            
            const detailHtml = `
                <table class="detail-table">
                    <tr>
                        <td colspan="2" class="detail-section-title">üìã Âü∫Êú¨Ë≥áË®ä</td>
                    </tr>
                    <tr>
                        <th>Âª∫ÈÄ†Âü∑ÁÖßËôüÁ¢º</th>
                        <td>${permit.permitNumber || '-'}</td>
                    </tr>
                    <tr>
                        <th>Á¥¢ÂºïÁ¢º</th>
                        <td>${permit.indexKey}</td>
                    </tr>
                    <tr>
                        <th>Âπ¥‰ªΩ</th>
                        <td>${permit.permitYear}Âπ¥</td>
                    </tr>
                    <tr>
                        <th>ÁôºÁÖßÊó•Êúü</th>
                        <td>${permit.issueDate ? formatDate(permit.issueDate) : '-'}</td>
                    </tr>
                </table>
                
                <table class="detail-table">
                    <tr>
                        <td colspan="2" class="detail-section-title">üë∑ Áõ∏Èóú‰∫∫Âì°</td>
                    </tr>
                    <tr>
                        <th>Ëµ∑ÈÄ†‰∫∫</th>
                        <td>${permit.applicantName || '-'}</td>
                    </tr>
                    <tr>
                        <th>Ë®≠Ë®à‰∫∫</th>
                        <td>${permit.designerName || '-'}</td>
                    </tr>
                    <tr>
                        <th>Ë®≠Ë®à‰∫ãÂãôÊâÄ</th>
                        <td>${permit.designerCompany || '-'}</td>
                    </tr>
                    <tr>
                        <th>Áõ£ÈÄ†‰∫∫</th>
                        <td>${permit.supervisorName || '-'}</td>
                    </tr>
                    <tr>
                        <th>Áõ£ÈÄ†‰∫ãÂãôÊâÄ</th>
                        <td>${permit.supervisorCompany || '-'}</td>
                    </tr>
                    <tr>
                        <th>ÊâøÈÄ†‰∫∫</th>
                        <td>${permit.contractorName || '-'}</td>
                    </tr>
                    <tr>
                        <th>ÁáüÈÄ†Âª†ÂïÜ</th>
                        <td>${permit.contractorCompany || '-'}</td>
                    </tr>
                    <tr>
                        <th>Â∞à‰ªªÂ∑•Á®ã‰∫∫Âì°</th>
                        <td>${permit.engineerName || '-'}</td>
                    </tr>
                </table>
                
                <table class="detail-table">
                    <tr>
                        <td colspan="2" class="detail-section-title">üìç Âü∫Âú∞Ë≥áË®ä</td>
                    </tr>
                    <tr>
                        <th>Âü∫Âú∞Âú∞ÂùÄ</th>
                        <td>${permit.siteAddress || '-'}</td>
                    </tr>
                    <tr>
                        <th>Âú∞Ëôü</th>
                        <td>${permit.landNumber || extractLandNumber(permit.siteAddress) || '-'}</td>
                    </tr>
                    <tr>
                        <th>Ë°åÊîøÂçÄ</th>
                        <td>${permit.district || extractDistrict(permit.siteAddress) || '-'}</td>
                    </tr>
                    <tr>
                        <th>‰ΩøÁî®ÂàÜÂçÄ</th>
                        <td>${permit.siteZone || '-'}</td>
                    </tr>
                    <tr>
                        <th>Âü∫Âú∞Èù¢Á©ç</th>
                        <td>${permit.siteArea ? permit.siteArea + ' m¬≤' : '-'}</td>
                    </tr>
                </table>
                
                <table class="detail-table">
                    <tr>
                        <td colspan="2" class="detail-section-title">üè¢ Âª∫ÁØâË≥áË®ä</td>
                    </tr>
                    <tr>
                        <th>Â±§Ê£üÊà∂Êï∏</th>
                        <td>${permit.floorInfo || '-'}</td>
                    </tr>
                    <tr>
                        <th>Ê®ìÂ±§</th>
                        <td>${permit.floors || '-'}</td>
                    </tr>
                    <tr>
                        <th>Ê£üÊï∏</th>
                        <td>${permit.buildingCount || '-'}</td>
                    </tr>
                    <tr>
                        <th>Êà∂Êï∏</th>
                        <td>${permit.unitCount || '-'}</td>
                    </tr>
                    <tr>
                        <th>Á∏ΩÊ®ìÂú∞ÊùøÈù¢Á©ç</th>
                        <td>${permit.totalFloorArea ? (typeof permit.totalFloorArea === 'number' ? permit.totalFloorArea.toLocaleString() + ' m¬≤' : permit.totalFloorArea + ' m¬≤') : '-'}</td>
                    </tr>
                </table>
                
                <table class="detail-table">
                    <tr>
                        <td colspan="2" class="detail-section-title">üîó Áõ∏ÈóúÈÄ£Áµê</td>
                    </tr>
                    <tr>
                        <th>ÊîøÂ∫úÁ∂≤Á´ôÈÄ£Áµê</th>
                        <td>
                            <a href="https://mcgbm.taichung.gov.tw/bupic/pages/queryInfoAction.do?INDEX_KEY=${permit.indexKey}" 
                               target="_blank" class="btn-link">
                                Êü•ÁúãÂéüÂßãË≥áÊñô
                            </a>
                        </td>
                    </tr>
                    <tr>
                        <th>Áà¨ÂèñÊôÇÈñì</th>
                        <td>${formatDateTime(permit.crawledAt)}</td>
                    </tr>
                </table>
            `;
            
            document.getElementById('permitDetail').innerHTML = detailHtml;
            document.getElementById('permitModal').style.display = 'block';
        }
        
        // ÈóúÈñâ Modal
        function closeModal() {
            document.getElementById('permitModal').style.display = 'none';
        }
        
        // ÈªûÊìä Modal Â§ñÈÉ®ÈóúÈñâ
        window.onclick = function(event) {
            const modal = document.getElementById('permitModal');
            if (event.target == modal) {
                modal.style.display = 'none';
            }
        }
        
        // Ê†ºÂºèÂåñÊó•ÊúüÊôÇÈñì
        function formatDateTime(dateTimeStr) {
            if (!dateTimeStr) return '-';
            const date = new Date(dateTimeStr);
            return date.toLocaleString('zh-TW');
        }
        
        // ËºîÂä©ÂáΩÊï∏
        function formatDate(dateStr) {
            if (!dateStr) return '-';
            const date = new Date(dateStr);
            return date.toLocaleDateString('zh-TW');
        }
        
        function formatTime(timeStr) {
            const date = new Date(timeStr);
            return date.toLocaleTimeString('zh-TW', { hour: '2-digit', minute: '2-digit' });
        }
        
        function calculateDuration(start, end) {
            const startTime = new Date(start);
            const endTime = new Date(end);
            const duration = (endTime - startTime) / 1000;
            
            if (duration < 60) {
                return `${duration.toFixed(1)} Áßí`;
            } else {
                const minutes = Math.floor(duration / 60);
                const seconds = (duration % 60).toFixed(0);
                return `${minutes} ÂàÜ ${seconds} Áßí`;
            }
        }
        
        // ÂæûÂú∞ÂùÄ‰∏≠ÊèêÂèñÂú∞Ëôü
        function extractLandNumber(address) {
            if (!address) return '-';
            
            const fullMatch = address.match(/(Ëá∫‰∏≠Â∏Ç[^ÂçÄ]+ÂçÄ[^ÊÆµ]+ÊÆµ[\d-]+Âú∞Ëôü)/);
            if (fullMatch) return fullMatch[1];
            
            const simpleMatch = address.match(/([^Â∏ÇÂçÄ]+ÊÆµ[\d-]+Âú∞Ëôü)/);
            if (simpleMatch) return simpleMatch[1];
            
            return address.length > 30 ? address.substring(0, 30) + '...' : address;
        }
        
        // ÂæûÂú∞ÂùÄ‰∏≠ÊèêÂèñË°åÊîøÂçÄ
        function extractDistrict(address) {
            if (!address) return null;
            
            const fullMatch = address.match(/Ëá∫‰∏≠Â∏Ç([^ÂçÄ]+ÂçÄ)/);
            if (fullMatch) return fullMatch[1];
            
            const districts = [
                'Ë•øÂ±ØÂçÄ', 'ÂçóÂ±ØÂçÄ', 'ÂåóÂ±ØÂçÄ', 'Ë•øÂçÄ', 'ÂçóÂçÄ', 'ÂåóÂçÄ', 'Êù±ÂçÄ', '‰∏≠ÂçÄ',
                'Â§™Âπ≥ÂçÄ', 'Â§ßÈáåÂçÄ', 'ÁÉèÊó•ÂçÄ', 'Ë±êÂéüÂçÄ', 'ÈúßÂ≥∞ÂçÄ', 'Â§ßÈõÖÂçÄ', 'ÊΩ≠Â≠êÂçÄ',
                'ÂêéÈáåÂçÄ', 'Á•ûÂ≤°ÂçÄ', 'Ê¢ßÊ£≤ÂçÄ', 'Ê∏ÖÊ∞¥ÂçÄ', 'Â§ßÁî≤ÂçÄ', 'Â§ñÂüîÂçÄ', 'Â§ßÂÆâÂçÄ',
                'Ê≤ôÈπøÂçÄ', 'Èæç‰∫ïÂçÄ', 'Â§ßËÇöÂçÄ', 'Êñ∞Á§æÂçÄ', 'Áü≥Â≤°ÂçÄ', 'Êù±Âã¢ÂçÄ', 'ÂíåÂπ≥ÂçÄ'
            ];
            
            for (const district of districts) {
                if (address.includes(district)) return district;
            }
            return null;
        }
        
        // ÈñãÂßãËºâÂÖ•Ë≥áÊñô
        // Êõ¥Êñ∞ÂàÜÈ†ÅÊéßÂà∂
        function updatePagination() {
            const totalPages = Math.ceil(filteredPermits.length / pageSize);
            const paginationHtml = createPaginationHtml(totalPages);
            
            document.getElementById('paginationTop').innerHTML = paginationHtml;
            document.getElementById('paginationBottom').innerHTML = paginationHtml;
        }
        
        // ÂâµÂª∫ÂàÜÈ†ÅHTML
        function createPaginationHtml(totalPages) {
            if (totalPages <= 1) return '';
            
            let html = '<div class="pagination-controls">';
            
            // ÂàÜÈ†ÅË≥áË®ä
            html += `<div class="pagination-info">
                ÂÖ± ${filteredPermits.length} Á≠ÜÔºåÁ¨¨ ${currentPage} / ${totalPages} È†Å
            </div>`;
            
            // ÂàÜÈ†ÅÊåâÈàï
            html += '<div class="page-buttons">';
            
            // ‰∏ä‰∏ÄÈ†Å
            html += `<button class="page-btn" onclick="changePage(${currentPage - 1})" ${currentPage === 1 ? 'disabled' : ''}>
                ‰∏ä‰∏ÄÈ†Å
            </button>`;
            
            // È†ÅÁ¢ºÊåâÈàï
            const maxButtons = 5;
            let startPage = Math.max(1, currentPage - Math.floor(maxButtons / 2));
            let endPage = Math.min(totalPages, startPage + maxButtons - 1);
            
            if (endPage - startPage < maxButtons - 1) {
                startPage = Math.max(1, endPage - maxButtons + 1);
            }
            
            if (startPage > 1) {
                html += '<button class="page-btn" onclick="changePage(1)">1</button>';
                if (startPage > 2) html += '<span style="margin: 0 5px;">...</span>';
            }
            
            for (let i = startPage; i <= endPage; i++) {
                html += `<button class="page-btn ${i === currentPage ? 'active' : ''}" onclick="changePage(${i})">${i}</button>`;
            }
            
            if (endPage < totalPages) {
                if (endPage < totalPages - 1) html += '<span style="margin: 0 5px;">...</span>';
                html += `<button class="page-btn" onclick="changePage(${totalPages})">${totalPages}</button>`;
            }
            
            // ‰∏ã‰∏ÄÈ†Å
            html += `<button class="page-btn" onclick="changePage(${currentPage + 1})" ${currentPage === totalPages ? 'disabled' : ''}>
                ‰∏ã‰∏ÄÈ†Å
            </button>`;
            
            html += '</div>';
            
            // ÊØèÈ†ÅÁ≠ÜÊï∏ÈÅ∏ÊìáÂô®
            html += `<div class="page-size-selector">
                <label>ÊØèÈ†ÅÈ°ØÁ§∫Ôºö</label>
                <select onchange="changePageSize(this.value)">
                    <option value="50" ${pageSize === 50 ? 'selected' : ''}>50Á≠Ü</option>
                    <option value="100" ${pageSize === 100 ? 'selected' : ''}>100Á≠Ü</option>
                    <option value="200" ${pageSize === 200 ? 'selected' : ''}>200Á≠Ü</option>
                </select>
            </div>`;
            
            html += '</div>';
            
            return html;
        }
        
        // ÂàáÊèõÈ†ÅÈù¢
        function changePage(page) {
            const totalPages = Math.ceil(filteredPermits.length / pageSize);
            if (page < 1 || page > totalPages) return;
            
            currentPage = page;
            renderPermits();
            
            // Êç≤ÂãïÂà∞Ë°®Ê†ºÈ†ÇÈÉ®
            document.querySelector('.main-section').scrollIntoView({ behavior: 'smooth', block: 'start' });
        }
        
        // ÊîπËÆäÊØèÈ†ÅÁ≠ÜÊï∏
        function changePageSize(size) {
            pageSize = parseInt(size);
            currentPage = 1;
            renderPermits();
        }
        
        // ÊêúÂ∞ãÈù¢ÊùøÂàáÊèõ
        function toggleSearchPanel() {
            const panel = document.getElementById('searchPanel');
            searchPanelOpen = !searchPanelOpen;
            
            if (searchPanelOpen) {
                panel.classList.add('active');
            } else {
                panel.classList.remove('active');
            }
        }
        
        // ËºâÂÖ•ÂØ∂‰Ω≥ÂÖ¨Âè∏ÂêçÂñÆ
        async function loadBaojiaCompanies() {
            try {
                const response = await fetch('https://objectstorage.ap-tokyo-1.oraclecloud.com/n/nrsdi1rz5vl8/b/taichung-building-permits/o/baojia_companies.json');
                const data = await response.json();
                baojiaCompanies = data.companies || [];
                console.log('ËºâÂÖ•ÂØ∂‰Ω≥ÂÖ¨Âè∏ÂêçÂñÆ:', baojiaCompanies.length, 'ÂÆ∂');
            } catch (error) {
                console.error('ËºâÂÖ•ÂØ∂‰Ω≥ÂÖ¨Âè∏ÂêçÂñÆÂ§±Êïó:', error);
                baojiaCompanies = [];
            }
        }
        
        // ÂàáÊèõÂØ∂‰Ω≥ÁØ©ÈÅ∏
        function toggleBaojiaFilter() {
            baojiFilterActive = document.getElementById('baojiaFilter').checked;
            applyFilters();
        }
        
        // ÂØ∂‰Ω≥Êô∫ÊÖßÂåπÈÖç
        function isBaojiaCompany(applicantName) {
            if (!applicantName || baojiaCompanies.length === 0) return false;
            
            // Ê∏ÖÁêÜÁî≥Ë´ã‰∫∫ÂêçÁ®±
            let cleanName = applicantName
                .replace(/Ë≤†Ë≤¨‰∫∫[Ôºö:].+$/g, '')
                .replace(/‰ª£Ë°®‰∫∫[Ôºö:].+$/g, '')
                .replace(/\s+Á≠âÂ¶ÇÈôÑË°®$/g, '')
                .trim();
            
            // ÂÖ¨Âè∏ÂêçÁ®±ÂæåÁ∂¥
            const suffixes = ['ËÇ°‰ªΩÊúâÈôêÂÖ¨Âè∏', 'ÊúâÈôêÂÖ¨Âè∏', 'Âª∫Ë®≠ËÇ°‰ªΩÊúâÈôêÂÖ¨Âè∏', 'ÁáüÈÄ†ËÇ°‰ªΩÊúâÈôêÂÖ¨Âè∏', 'ÁáüÈÄ†ÊúâÈôêÂÖ¨Âè∏'];
            
            return baojiaCompanies.some(company => {
                // ÂÆåÂÖ®ÂåπÈÖç
                if (cleanName === company) return true;
                
                // ÁßªÈô§ÂæåÁ∂¥ÊØîÂ∞ç
                let companyBase = company;
                let nameBase = cleanName;
                
                for (const suffix of suffixes) {
                    companyBase = companyBase.replace(suffix, '');
                    nameBase = nameBase.replace(suffix, '');
                }
                
                if (companyBase === nameBase) return true;
                
                // ÂåÖÂê´Èóú‰øÇÊ™¢Êü•
                if (cleanName.includes(company) || company.includes(cleanName)) return true;
                
                return false;
            });
        }
        
        // Ê∏ÖÈô§ÊâÄÊúâÊêúÂ∞ã
        function clearAllSearches() {
            document.getElementById('applicantSearchDesktop').value = '';
            document.getElementById('applicantSearchMobile').value = '';
            document.getElementById('aiSearchInputDesktop').value = '';
            document.getElementById('aiSearchInputMobile').value = '';
            document.getElementById('aiSearchResultsDesktop').innerHTML = '';
            document.getElementById('aiSearchResultsMobile').innerHTML = '';
            aiSearchConditions = null;
            clearFilters();
            toggleSearchPanel();
        }
        
        init();
        
        // ÊØè5ÂàÜÈêòËá™ÂãïÊõ¥Êñ∞‰∏ÄÊ¨°
        setInterval(init, 5 * 60 * 1000);
    </script>
</body>
</html>